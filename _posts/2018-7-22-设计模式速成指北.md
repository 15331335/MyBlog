---
layout: post
title: "è®¾è®¡æ¨¡å¼é€ŸæˆæŒ‡åŒ—"
description: "Design Patterens For Myself! è®¾è®¡æ¨¡å¼æ˜¯å¸¸è§é—®é¢˜çš„æœ‰æ•ˆè§£å†³æ–¹æ³•ã€‚"
thumb_image: "documentation/sample-image.jpg"
tags: [design]
---


## åœ¨æ­¤ä¹‹å‰

- è¿™æ˜¯ä¸ªäººå­¦ä¹ ç¬”è®°ï¼Œå†…å®¹çš„ä¼ªä»£ç å‡ä¸º free style ä»¥æ–¹ä¾¿ç†è§£ï¼Œå¹¶ä¸éµå¾ªç‰¹å®šè¯­æ³•è§„åˆ™ã€‚
- ä¸ªäººè®¤ä¸ºè¿™äº›è®¾è®¡æ¨¡å¼çš„ä¼˜åŠ¿é€šå¸¸ä¸é¡¹ç›®è§„æ¨¡æ­£ç›¸å…³ï¼Œè€Œå†…å®¹ä¸­é‡‡ç”¨çš„ä¾‹å­å¯èƒ½è¿‡äºç®€å•å®¹æ˜“å‡ºç°ã€Œè¿‡åº¦è®¾è®¡ã€çš„è¯¯è§£ã€‚
- ç»“æ„å’Œå†…å®¹å‚è€ƒäº† [**design-patterns-for-humans**](https://github.com/kamranahmedse/design-patterns-for-humans) å’Œ [**èœé¸Ÿæ•™ç¨‹|è®¾è®¡æ¨¡å¼**](http://www.runoob.com/design-pattern/design-pattern-tutorial.html) ç­‰æœ‰ç”¨çš„é“¾æ¥ã€‚
- $6 + 7 + 10 = 23$



## Creational

è¿™ç±»è®¾è®¡æ¨¡å¼å…³æ³¨ï¼š

- å¦‚ä½•å®ä¾‹åŒ–
- å¦‚ä½•ç»„ç»‡å¯¹è±¡



### ç®€å•å·¥å‚

é¦–å…ˆæ¥çœ‹ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªå®ç°ç±»ï¼š

```java
interface Person {
    func getName();
}

class Worker implements Person {
    var name;
    func __construct(n) { this->name = n; }
    func getName() { return this->name; }
}
```

ä¸‹é¢æ˜¯ç®€å•å·¥å‚ç±»ï¼š

```java
class SimpleFactory {
    func employWorker(name) {
        return new Worker(name);
    }
}
```

æ˜¾ç„¶ç®€å•çš„äº‹æƒ…å˜å¤æ‚äº†ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬ç›´æ¥åˆ›å»ºå¯¹è±¡è€Œä¸æ˜¯é€šè¿‡å·¥å‚ã€‚è€Œå·¥å‚æ¨¡å¼çš„ä¼˜åŠ¿æ˜¯åœ¨äº**åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ¶‰åŠé€»è¾‘åˆ¤æ–­**çš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š

```Java
interface Person { ... }

class Worker implements Person { ... }
class Manager implements Person { ... }

class Factory {
    func employ(type) {
        if (type) {
            return new Worker();
        } else {
            return new Manager();
        }
    }
}
```

è¿›ä¸€æ­¥è€Œè¨€ï¼Œå·¥å‚å¯ä»¥å°è£…ä»ç‰¹å¾æ¨å¯¼ç±»å‹çš„é€»è¾‘ï¼š

{% mermaid %}
graph LR
a[ç‰¹å¾1] --> c[å·¥å‚]
b[ç‰¹å¾2] --> c
e[...] --> c
c--ç±»å‹-->d[å¯¹è±¡]
{% endmermaid %}

è¿™æ ·çš„å¥½å¤„æ˜¯åœ¨**ç»å¸¸åˆ›å»ºä¸å®šç±»å‹çš„å¯¹è±¡**æ—¶ä¸ç”¨é‡å¤å¤ªå¤šçš„ä»£ç ã€‚



### å·¥å‚æ–¹æ³•

åŒæ ·åœ°ï¼Œå…ˆæ¥çœ‹ä¸‹é¢ã€Œè€å¸ˆã€çš„æ¥å£å’Œå®ç°ç±»ï¼š

```java
interface Teacher {
    func teach();
}
class ChineseTeacher implements Teacher {
    func teach() { /* Chinese */ }
}
class EnglishTeacher implements Teacher {
    func teach() { /* English */ }
}
```

æ¥ç€æ˜¯ä¸€ä¸ªã€Œè¯¾ç¨‹ã€çš„æŠ½è±¡ç±»åŠå…¶ç»§æ‰¿ï¼š

```java
abstract class Course {
    // factory method
    abstract func getTeacher();
    
    func take() {
        this->getTeacher->teach();
    }
}

class ChineseCourse extends Course {
    func getTeacher { return new ChineseTeacher(); }
}
class EnglishCourse extends Course {
    func getTeacher { return new EnglishTeacher(); }
}
```

é‚£ä¹ˆå°±å¯ä»¥å¼€å§‹ã€Œä¸Šè¯¾ã€äº†ï¼š

```java
var C = new ChineseCourse();
C->take()
```

ä»è°ƒç”¨é“¾æ¥çœ‹ï¼Œæˆ‘ä»¬å…³æ³¨ä¸­é—´çš„å·¥å‚æ–¹æ³•ï¼š

{% mermaid %}
graph LR
a[take] --> b[getTeacher]
b --> c[teach]
{% endmermaid %}

å¯¹æ¯”å·¥å‚æ–¹æ³•å’Œç®€å•å·¥å‚ï¼šå‰è€…æ‰€è°“çš„å·¥å‚æ˜¯ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œåè€…å·¥å‚æœ¬èº«å°±æ˜¯ä¸€ä¸ªç±»ï¼›ä¸¤è€…ç±»ä¼¼çš„æƒ…å†µï¼Œä¸€ä¸ªç±»çš„æ–¹æ³•æ‰€ä¾èµ–çš„å­ç±»åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç¡®å®šã€‚



### æŠ½è±¡å·¥å‚

ç®€è€Œè¨€ä¹‹ï¼Œå·¥å‚ä»¬çš„å·¥å‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç°å®ä¸–ç•Œçš„ä¾‹å­ï¼š

> - é—¨ï¼ˆæ¥å£ï¼‰æœ‰ä¸¤ç§ï¼ˆå®ç°ç±»ï¼‰ï¼šæœ¨é—¨å’Œé“é—¨ã€‚
> - ä¿®ç†å·¥ï¼ˆæ¥å£ï¼‰æœ‰å¯¹åº”çš„ä¸¤ç§ï¼ˆå®ç°ç±»ï¼‰ï¼šç„Šå·¥å’Œæœ¨åŒ ã€‚
> - é‚£ä¹ˆé—¨çš„å·¥å‚ä¹Ÿæœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å¯ä»¥**åˆ¶ä½œ**æœ¨é—¨å’Œæä¾›æœ¨é—¨**ä¿®ç†**æœåŠ¡çš„å·¥å‚ï¼Œå¦ä¸€ç§æ˜¯é“é—¨çš„ã€‚

```java
interface DoorFactory {
    public func makeDoor() : Door;
    public func callRepairman() : Repairman;
}
```

ä»ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­è¿™ä¸ªæ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼šå¤šç§å¯¹è±¡æœ‰ä¾èµ–å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ ·çš„æŠ½è±¡å·¥å‚å…¶å®æ˜¯åœ¨ç»„è£…å¤šä¸ªå·¥å‚çš„äº§å“ã€‚



### å»ºé€ è€…

è€ƒè™‘è¿™æ ·ä¸€ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°ï¼šå¤šå¯é€‰å‚æ•°æˆ–å¤šæ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œä¸€æ¯å¯å®šåˆ¶çš„ã€Œå’–å•¡ã€å¦‚ä¸‹ï¼š

```java
class Coffee {
    func __construct(size, sugar = false);
}
```

å¯¹äºè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬å°†å…¶å¤šä¸ªæ„é€ å‚æ•°è½¬æ¢æˆä¸€ä¸ªå»ºé€ è€…ï¼š

```Java
class Coffee {
    var size, sugar = false;
    func __construct(builder) { // builder is a CoffeeBuilder
        this->size = builder->size;
        this->sugar = builder->sugar;
    }
}
```

æŠ½è±¡å‡ºæ„é€ è€…ç±»çš„å¥½å¤„åœ¨äºåˆ†ç¦»å‡ºæ„é€ å‚æ•°çš„æ§åˆ¶æ–¹æ³•ï¼š

```Java
class CoffeeBuilder {
    var size, sugar = false, ice = false;
    
    func __construct(s) { this->size = s; }
    func addSugar() { this->sugar = true; }
    func addIce() { this->ice = true; }
    
    func build() {
        return new Coffee(this);
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¼˜é›…åœ°å–ä¸Šä¸€å°æ¯å’–å•¡äº†ï¼š

```java
var coffee = (new CoffeeBuilder(small))->addSugar()->build();
```

æ•´ä¸ªæ¨¡å¼çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

{% mermaid %}
graph LR
a[å»ºé€ è€…] --1.è°ƒå‚--> a
a --2.å»ºé€ --> b[å¯¹è±¡]
b --3.å¼•ç”¨--> a
{% endmermaid %}

æ˜¾ç„¶ï¼Œè¿™æ ·åšå¯ä»¥é¿å…æ„é€ å‡½æ•°çš„å†—é•¿ï¼Œè€ŒåŒºåˆ«äºå·¥å‚çš„å•æ­¥æ„é€ ï¼Œå»ºé€ è€…æ˜¯é’ˆå¯¹å¤šæ­¥çš„ã€‚



### åŸå‹

å¯ä»¥è¿™ä¹ˆè¯´ï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œå…¶ä»–çš„å¯¹è±¡å¯ä»¥**æ ¹æ®åŸå‹æ¥å…‹éš†**æˆ–æ„é€ ã€‚

```Java
var prototype = new Sheep(name);
prototype->getName();  // name
var cloned = prototype->clone();
cloned->setName('Dolly');
cloned->getName();  // 'Dolly'
```

ç›´è§‚æ„Ÿå—å°±æ˜¯å¯¹è±¡çš„æ·±æ‹·è´ã€‚



### å•ä¾‹

ä¸€å¥è¯ï¼Œç±»çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªã€‚

- ä½œä¸ºä¸€ç§å…¨å±€çŠ¶æ€ï¼Œå¥½å¤„æ˜¯é¿å…ç±»çš„è¿‡åº¦ä½¿ç”¨ã€‚
- å¯èƒ½ä½¿å¾—ä»£ç é«˜è€¦åˆã€‚

å¸¸è§çš„åšæ³•æ˜¯ï¼š

```java
final class Life {
    private:
    	var instance = new Life();  // Always static!
    	func __construct() { /* hide */ }
    	func __clone() { /* disable */ }
   	public:
    	func getInstance() {
            return this->instance
    	}
}
```

ä½¿ç”¨çš„æ—¶å€™ï¼š

```java
Life mine = Life.getInstance();  // rather than 'new Life()'
```



## Structural

è¿™ç±»è®¾è®¡æ¨¡å¼å…³æ³¨ï¼š

- å¯¹è±¡çš„ç»„æˆæˆ–å®ä½“çš„å…³è”
- ç»„ä»¶åŒ–



### é€‚é…å™¨

å‡è®¾åœ¨ä¸€ä¸ªæ¸¸æˆä¸­ï¼Œã€ŒçŒäººã€å¯ä»¥ç‹©çŒå…”å­å’Œç‹—ï¼š

```java
interface Prey { func flee(); }

class ğŸ°Rabbit implements Prey {
    func flee() { /* run */ }
}
class ğŸ¶Dog implements Prey {
    func flee() { /* run */ }
}

class Hunter {
    func hunt(prey) { prey->flee(); }
}
```

å½“æ¸¸æˆéœ€è¦å…è®¸ç‹©çŒä»æœªæˆä¸ºè¿‡çŒç‰©çš„è€é¹°æ—¶ï¼š

```java
class ğŸ¦…Hawk {
    func fly() { /* fly */ }
} 

// Adapter
class HawkAdapter implements Prey {
    var hawk;
    func __construct(hawk) { this->hawk = hawk; }
    func flee { this->hawk->fly(); }
}
```

ä»é€‚é…å™¨çš„å®ç°ä¸Šä¸éš¾å‘ç°ï¼š

{% mermaid %}
graph LR
a[é€‚é…å™¨] --ç»´æŠ¤--> b[å¯¹è±¡]
b --è°ƒç”¨--> c[æ–¹æ³•]
{% endmermaid %}

å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªéœ€è¦é€‚é…çš„æ–°å¯¹è±¡ï¼Œå¹¶å®ç°äº†åŸæ¥å£çš„æ–¹æ³•ï¼Œé€‚é…çš„æ–¹æ³•å°±æ˜¯æŒ‡å®šåŸæ¥å£è°ƒç”¨æ–°å¯¹è±¡çš„æ–¹æ³•ã€‚



### æ¡¥æ¥

è¿™ä¸ªæ¨¡å¼çš„æ€æƒ³åœ¨äº**é€‰æ‹©ç»„æˆ**è€Œéç»§æ‰¿ï¼š

```Java
interface painting {
    func __construct(style)
}
class Landscape implements painting {
    var style;
    func __construct(style) { this->style = style; }
}

interface Style { /* ... */ }
class Oil implements Style { /* ... */ }
class Wash implements Style { /* ... */ }
```

ä¸Šé¢çš„ä¾‹å­å¾ˆå¥½ç†è§£ï¼Œåˆ†ç¦»äº†æŠ½è±¡å’Œç°å®ï¼š

{% mermaid %}
graph TD
a[é£æ™¯ç”»]-->b[ç”»ä½œ]
c[æ²¹ç”»]-->d[é£æ ¼]
e[æ°´å¢¨ç”»]-->d
f[...]-->d
g[...]-->b
{% endmermaid %}

å¦‚æœåœ¨æŠ½è±¡èšåˆå…³è”å…³ç³»æ—¶é€‰æ‹©ç»§æ‰¿ï¼š

{% mermaid %}
graph TD
a[é£æ™¯æ²¹ç”»]-->b[æ²¹ç”»]
b-->c[ç”»ä½œ]
d[...]-->b
e[é£æ™¯æ°´å¢¨ç”»]-->f[æ°´å¢¨ç”»]
g[...]-->f
f-->c
h[...]-->c
{% endmermaid %}

è¿™æ ·ä¸åˆ©äºè§£è€¦ã€‚



### ç»„åˆ

ç»„åˆå°±æ˜¯ä¸€ä¸ªå¯¹è±¡é‡Œé¢åŒ…å«äº†è®¸å¤šåŒç±»çš„å­å¯¹è±¡ï¼Œå¹¶ä¸ºå­å¯¹è±¡è¿›è¡Œç»Ÿä¸€çš„æ“ä½œã€‚

```java
interface Employee {
    func __construct(name, salary);
    func get*();  // getter
    func set*();  // setter
}

class Developer implements Employee { /* ... */ }
class Developer implements Employee { /* ... */ }

class Organization {
    var employees = [];
    func employ(name) {
        this->employees->push(new Employee(name));
    }
    func listEmployees() {  // in a uniform manner
        for (employee in this->employees) {
            employee->getName();
        }
    }
}
```

ä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯ç‰¹å¾ï¼šæ“ä½œç®€å•ï¼Œå¹¶ä¸”è‡ªç”±å¢åˆ 



### è£…é¥°å™¨

è£…é¥°å™¨çš„ç›®çš„åœ¨äºè¿è¡Œæ—¶åŒ…è£¹å¯¹è±¡ä»è€ŒåŠ¨æ€æ”¹å˜å…¶è¡Œä¸ºã€‚

```java
interface Book {
    func getDescription();
}

class OriginalBook implements Book {
    func getDescription() {
        return 'It is original.';
    }
}

// add-ons (decorators)
class ForeignBook implements Book {
    var book;
    func __construct(book) { this->book = book; }
    func getDescription() {
        return this->book->getDescription() + ' Foreign.';
    }
}
class IllustratedBook implements Book {
    var book;
    func __construct(book) { this->book = book; }
    func getDescription() {
        return this->book->getDescription() + ' Illustrated.';
    }
}
```

åœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä¸æ–­åœ°æ·»åŠ å¯¹äºã€Œä¹¦ã€çš„æè¿°ï¼š

```Java
var book = new OriginalBook();
book = new ForeignBook(book);
book->getDescription();  // 'It is original. Foreign.'
book = new IllustratedBook(book);
book->getDescription();  // 'It is original. Foreign. Illustrated.'
```

ä¸æƒ³å¢åŠ å¾ˆå¤šå­ç±»è€Œæ‰©å±•ç±»çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è£…é¥°å™¨ã€‚



### å¤–è§‚

éšè—å¤æ‚ç³»ç»Ÿï¼Œæä¾›ç®€å•æ¥å£ã€‚

```java
class Computer {
    func stepA() { /* return this; */ }
    func stepB() { /* ... */ }
    func stepC() { /* ... */ }
}

class ComputerFacade {
    var computer;
    func __construct(computer) { this->computer = computer; }
    func turnOn() {
        this->computer->stepA();
        this->computer->stepB();
        this->computer->stepC();
        // this->computer->stepA()->stepB()-stepC();
    }
}
```

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œç”µè„‘çš„å¯åŠ¨è¿‡ç¨‹åŒ…å«è¯¸å¤šç³»ç»Ÿæ­¥éª¤ï¼ˆå¦‚å¯åŠ¨å¤„ç†å™¨ã€å¯åŠ¨å­˜å‚¨å™¨ç­‰ï¼‰ï¼Œè€Œæš´éœ²ç»™ç”¨æˆ·çš„åªæœ‰ä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯æŒ‰ä¸‹ç”µæºé”®ã€‚



### äº«å…ƒ

æ€æƒ³æ˜¯é€šè¿‡**ç¼“å­˜**çš„æ–¹å¼å‡å°‘å­˜å‚¨æˆ–è®¡ç®—çš„å¼€é”€ã€‚

```java
class Tool { /* type & ... */ }

// Anything that will be cached is flyweight.
class Toolbox {
    var tools = [];
    func getTool(type) {
        if (tools[type]->isEmpty()) {
            this->tools[type] = new Tool[type];
        }
        return this->tools[type];
    }
}

class Repairman {
    var toolbox;
    func __construct(toolbox) { this->toolbox = toolbox; }
    func check(type) {
        this->toolbox->getTool(type);
    }
    // repair
}
```

è¿™ä¸ªç°å®çš„ä¾‹å­æ˜¯ï¼šä¿®ç†å·¥æœ‰ä¸€ä¸ªå·¥å…·ç®±ï¼Œæ¯å½“éœ€è¦ä¸€ç§å·¥å…·æ—¶å…ˆæ£€æŸ¥å·¥å…·ç®±ï¼Œå¦‚æœæ²¡æœ‰åˆ™è´­ä¹°æ–°çš„å¹¶æ”¾è¿›å»ï¼Œè¿™æ ·ä»¥åå¯ä»¥åå¤ä½¿ç”¨ä¸ç”¨æ¯æ¬¡ä¿®ç†éƒ½è´­ä¹°æ–°çš„å·¥å…·ã€‚



### ä»£ç†

å…¸å‹è§£é‡Šæ˜¯ä¸€ä¸ªç±»ä»£è¡¨å¦ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚

ä¸‹é¢çš„ä¾‹å­æè¿°äº†ä½¿ç”¨ä»£ç†è´­ä¹°ä¸œè¥¿çš„æƒ…å½¢ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªéœ€è¦ä»˜é’±æ”¶è´§å³å¯ï¼Œå‰å‰ååçš„ç¹çäº‹æƒ…éƒ½åœ¨ä»£ç†ä¸­è¢«å¤„ç†äº†ã€‚

```java
interface Abstract { func buy(something); }
class Real implements Abstract {
    fun buy(something) { /* pay */ }
}
class Prxoy implements Abstract {
    var real;
    func __construct(real) { this->real = real; }
    fun buy(something) {
        // sth. tedious before
        this->real->buy(something);
        // sth. tedious after
    }
}
```

é‡ç‚¹åœ¨äºï¼šä»£ç†æŒæœ‰çœŸå®å¯¹è±¡çš„å¼•ç”¨ã€‚ä¸åŒäºç±»çš„ç®€å•ç»„åˆï¼Œä»£ç†ä¸çœŸå®å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªæŠ½è±¡æ¥å£çš„å®ç°ã€‚



## Behavioral

è¿™ç±»è®¾è®¡æ¨¡å¼å…³æ³¨ï¼š

- å¯¹è±¡é—´èŒè´£çš„åˆ†é…
- ä¿¡æ¯äº¤æµ



### è´£ä»»é“¾

é€šè¿‡åˆ›å»ºä¸€æ¡å¯¹è±¡é“¾ï¼Œä½¿å¾—è¯·æ±‚æ²¿ç€é“¾æ‰¾åˆ°åˆé€‚çš„å“åº”æ–¹æ³•ã€‚

```Java
abstract class Account {
    var balance;
    var next;
    func setNext(account) { this->next = account; }
    func pay(amount) {
        if (this->balance >= amount) { /* pay it */ }
        else if (this->next) {
            this->next->pay(amount)
        } else { /* not afford */ }
    }
}

class PocketMoney extends Account {
    var balance;
    func __construct(money) { this->balance = money; }
}
class BankCard extends Account { /* ... */ }
```

å½“æˆ‘ä»¬æ”¯ä»˜çš„æ—¶å€™ï¼Œå¦‚æœé›¶é’±ä¸å¤Ÿå°±ç”¨é“¶è¡Œå¡ï¼š

```java
var pocketmoney = new PocketMoney(200);
var bankcard = new BankCard(500);

// a chain: $PocketMoney->$BankCard
pocketmoney->setNext(bankcard);

pocketmoney->pay(150);  // use PocketMoney
pocketmoney->pay(300);  // use BankCard
```

åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼š

- é€šå¸¸æ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹å¦ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚
- å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ã€‚



### å‘½ä»¤

é€šè¿‡å°è£…åŠ¨ä½œå¯¹ `client` å’Œ `receiver` è§£è€¦ï¼š

```java
class Receiver {
    func add() { /* +1 */ }
    func subtract() { /* -1 */ }
}

interface Command {
    func execute();
    func undo();
    func redo();
}
class Addition implements Command {
    var receiver;
    func __construct(receiver) { this->receiver = receiver; }
    func execute() { this->receiver->add(); }
    func undo() { this->receiver->subtract(); }
    func redo() { this->execute(); }
}
class Subtraction implements Command { /* ... */ }
```

ç±»ä¼¼äºé¥æ§å™¨çš„è¿œç¨‹æ§åˆ¶ï¼š

```Java
class Invoker {
    func submit(command) {
        command->execute();
    }
}
```

è¿™æ ·å°±å¯ä»¥é€šè¿‡æ„é€ å‘½ä»¤å¹¶å‘é€æ¥æ§åˆ¶æ¥æ”¶ç«¯ï¼š

```java
var receiver = new Receiver();
var addition = new Addition(receiver)
var invoker = new Invoker()
invokere->submit(addition);
```

ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ä¸Šè¿°å­˜åœ¨ `undo` æ“ä½œçš„äº‹åŠ¡ã€‚



### è¿­ä»£å™¨

ä¸€ç§è®¿é—®å¯¹è±¡å…ƒç´ çš„æ–¹å¼ï¼Œå…³é”®åœ¨äºæ— éœ€çŸ¥é“åº•å±‚çš„è¡¨ç¤ºã€‚

```Java
interface Iterator {
    func hasNext();
    func getNext();
}

interface Container {
   	func getIterator();
}
```

ä¸‹é¢å®ç°ä¸€ä¸ªæ”¯æŒè¿­ä»£è®¿é—®çš„ç±»ï¼š

```Java
class Repository implements Container {
    var elements = [ /* ... */ ];
    func getIterator() {
        return new RepoIterator();
    }
    
    private class RepoIterator implements Iterator {
        var index;
        func hasNext() {
            if (index < that->elements->len()) return true;
            else return false;
        }
        func getNext() {
            if (this->hasNext()) return that->elements[index++];
            else return NULL;
        }
    }
}
```

è¿­ä»£å™¨çš„å®ç°æœ‰èµ–äºå…·ä½“çš„è¯­æ³•è§„åˆ™ã€‚



### ä¸­ä»‹è€…

ç›®çš„æ˜¯é™ä½ç±»é—´äº¤äº’é€ æˆçš„è€¦åˆã€‚

å…¸å‹çš„èŠå¤©å®¤ä¾‹å­ï¼š

```java
// Mediator
class ChatRoom {
    func showMessage(user, message) {
        // show 'time, username & message'
    }
}

class User {
    var name, chatMediator;
    func __construct(name, chatMediator) {
        this->name = name;
        this->chatMediator = chatMediator;
    }
    func send(message) {
        this->chatMediator->showMessage(this, message);
    }
}
```

ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨èŠå¤©å®¤ä¸­é€šä¿¡ï¼Œæ³¨æ„åˆ°æ¯ä¸ªç”¨æˆ·åŒ…å«åŒæ ·çš„ä¸­ä»‹è€…å¼•ç”¨ï¼Œè¿™æ ·ç½‘çŠ¶çš„é€šä¿¡ç»“æ„è½¬æ¢æˆäº†æ˜Ÿå‹ç»“æ„ã€‚



### å¤‡å¿˜å½•

åœ¨æ¸¸æˆä¸­çš„å­˜æ¡£åŠŸèƒ½ï¼š

```java
class Memento {
    var content;
    func __construct(content) { /* ...*/ }
    func getContent() { /* ... */ }
}

class Game {
    var temp, saved;  // Memento
    func load() { return this->saved->getContent(); }
    func save() { this->saved = new Memento(temp); }
}
```

åˆé€‚çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼š

- éœ€è¦ä¿å­˜/æ¢å¤æ•°æ®çš„ç›¸å…³çŠ¶æ€åœºæ™¯
- æä¾›ä¸€ä¸ªå¯å›æ»šçš„æ“ä½œ



### è§‚å¯Ÿè€…

è¿™æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¸€ç§ä¾èµ–ï¼šä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜ï¼Œå‘ŠçŸ¥å®ƒçš„è§‚å¯Ÿè€…ã€‚

åœ¨å®ç°ä¸Šä¸éš¾ç†è§£ï¼Œåªè¦å¯¹è±¡æŒæœ‰è§‚å¯Ÿè€…å¼•ç”¨å³å¯ï¼š

```java
class Obj {
    var state, observers = [];
    func notify() {
        for (observer in this->observers) {
            observer->update(this->state);
        }
    }
    func change(state) {
        this->state = state;
        this->notify();
    }
}
```

å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ï¼Œæ³¨æ„é¿å…å¾ªç¯ä¾èµ–ã€‚



### è®¿é—®è€…

åœ¨è®¿é—®è€…ä¸­åŠ¨æ€åœ°ä¿®æ”¹å…³äºå¯¹è±¡çš„æ‰§è¡Œé€»è¾‘ï¼Œè€Œä¸ä¿®æ”¹å¯¹è±¡ã€‚

```Java
interface Visitee {
    func accept(operation);
}

interface Visitor {
    func visitButton(button);
    func visitSlider(slider);
    // overload: visit($element);
}
```

å…¶ä¸­ `Visitor` çš„è®¿é—®æ–¹æ³•å¯ä»¥æ ¹æ®è¯­æ³•è§„åˆ™ä½¿ç”¨é‡è½½ã€‚

```Java
class Button implements Visitee {
    func click() { /* ... */ }
    func accept(operation) {
        operation->visitButton(this);
    }
}
class Slider implements Visitee {
    func drag() { /* ... */ }
    func accept(operation) {
        operation->visitSlider(this);
    }
}

class UIOperation implements Visitor {
    func visitButton(button) { button->click(); }
    func visitSlider(slider) { slider->drag(); }
}
```

å¯¹äº UI æ§ä»¶è¿›è¡ŒåŠŸèƒ½ç»Ÿä¸€ï¼š

```Java
var operation = new UIOperation;
// ...
button->accept(operation);  // click button
slider->accept(operation);  // drag slider
```

æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

{% mermaid %}
graph LR
a[UIæ§ä»¶]--æ¥å—-->b[ç»Ÿä¸€çš„UIæ“ä½œ]
b--è®¿é—®-->c[å½“å‰UIæ§ä»¶çš„å¼•ç”¨]
c--è°ƒç”¨-->d[çœŸæ­£æ‰§è¡Œçš„æ“ä½œ]
{% endmermaid %}

ä¸Šé¢æ˜¯ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³ç¨³å®šçš„æ•°æ®ç»“æ„å’Œæ˜“å˜çš„æ“ä½œè€¦åˆé—®é¢˜ã€‚



### ç­–ç•¥

å…è®¸åˆ‡æ¢ç®—æ³•ã€‚

```java
interface Strategy {
    func sort(data);
}

class BubbleSort implements Strategy { /* ... */ }
class QuickSort implements Strategy { /* ... */ }
```

æˆ‘ä»¬éœ€è¦æŠ½è±¡ä¸Šä¸‹æ–‡æ¥å°è£…ç­–ç•¥å¼•ç”¨ï¼š

```java
class Context {
    var strategy;
    func __construct(algorithm) {  // strategy is algorithm
        this->strategy = algorithm;
    }
    func sort(data) {
        return this->strategy->sort(data);
    }
}
```

è¿™æ ·åœ¨è¿è¡Œæ—¶æ ¹æ®æƒ…å†µç”ŸæˆåŒ…å«ç­–ç•¥ç®—æ³•çš„å®ä¾‹ï¼š

```java
var sorter = new Context(new BubbleSort());
// or 'var sorter = new Context(new QuickSort());'
```

å¯ä»¥é¿å…å› ä¸ºä½¿ç”¨æ¡ä»¶è¯­å¥æ‰€å¸¦æ¥çš„å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚



### çŠ¶æ€

å½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚

è¿™ä¸ªè®¾è®¡æ¨¡å¼å¾ˆå¥½ç†è§£ä¹Ÿéå¸¸å¸¸è§ï¼Œå®ç°çš„æ–¹æ³•æ˜¯ï¼š

- å¯¹äºçŠ¶æ€è®¾è®¡ä¸€ä¸ªæ¥å£ï¼Œå¹¶å…è®¸ä¿®æ”¹
- å°è£…çŠ¶æ€åœ¨å¯¹è±¡ä¸­ç»´æŠ¤

```java
interface State {
    func action();
}

class StartState implements State { /* ... */ }
class EndState implements State { /* ... */ }

class Obj {
    var state;
    func __construct(state) { this->state = state; }
    func setState(state) { this->state = state; }
    func doSomething() { this->state->action(); }
}
```

ä¸€å¥è¯ï¼Œç±»çš„è¡Œä¸ºæ˜¯åŸºäºå…¶çŠ¶æ€çš„ã€‚



### æ¨¡æ¿æ–¹æ³•

åœ¨æŠ½è±¡ç±»å®ç°é€šç”¨çš„æ–¹æ³•ï¼Œè€Œå…¶ä»–çš„æ­¥éª¤åœ¨å­ç±»å®ç°ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è‡ªåŠ¨åŒ–æ„å»ºä¾‹å­ï¼š

```java
abstract class Builder {
    // Template method
    func build() {
        this->test()->lint()->assemble()->deploy();
    }

    func test();
    func lint();
    func assemble();
    func deploy();
}
```

é‡‡ç”¨åŒæ ·çš„æ„å»ºæµç¨‹ï¼Œè€Œå‰åç«¯çš„æ„å»ºç»†èŠ‚ä¸åŒï¼š

```Java
class FrontEndBuilder extends Builder { /* implementations */ }
class BackEndBuilder extends Builder { /* implementations */ }

// usage
var backend = new BackEndBuilder();
backend->build();
```

å¯ä»¥çœ‹åˆ°ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»ä¸æ”¹å˜ç®—æ³•ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚





## å†™åœ¨åé¢

- å—é™äºä¸ªäººçŸ¥è¯†ï¼Œå†…å®¹éš¾å…å·®é”™ï¼Œå¦‚æœæœ‰é—®é¢˜è¯·åœ¨ **issue** ä¸­æå‡ºã€‚
- å¯¹äºè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨åŸŸé—®é¢˜æ²¡æœ‰è¿‡å¤šå¼ºè°ƒï¼Œå¸Œæœ›åªè¦ä»£ç ä¼˜é›…å³å¯ã€‚
- **Star** â˜•ï¸